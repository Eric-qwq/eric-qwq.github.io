<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>下落式節奏遊戲</title>
<style>
body, html {
margin: 0;
padding: 0;
overflow: hidden;
background-color: #000;
color: #fff;
font-family: Arial, sans-serif;
height: 100%;
display: flex;
justify-content: center;
align-items: center;
text-align: center;
}
#game-container {
position: relative;
width: 100vw;
height: 100vh;
background-color: #111;
}
.track {
position: absolute;
bottom: 0;
width: 25%;
height: 100%;
border-left: 1px solid #333;
}
.track:last-child {
border-right: 1px solid #333;
}
.receptor {
position: absolute;
bottom: 10%;
width: 100%;
height: 12vh;
background-color: rgba(255, 255, 255, 0.2);
border-top: 2px solid #fff;
}
.receptor.active {
background-color: rgba(255, 255, 0, 0.5);
}
.note {
position: absolute;
width: 100%;
height: 5vh;
background-color: #0f0;
will-change: transform;
}
#score-display {
position: absolute;
top: 20px;
left: 50%;
transform: translateX(-50%);
font-size: 2em;
color: #fff;
z-index: 10;
}
#start-screen {
position: absolute;
width: 100%;
height: 100%;
background-color: rgba(0,0,0,0.8);
z-index: 20;
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
}
#start-button {
padding: 15px 30px;
font-size: 1.5em;
cursor: pointer;
border: 2px solid #fff;
background-color: #000;
color: #fff;
border-radius: 10px;
}
#combo-display {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
font-size: 4em;
color: rgba(255, 255, 255, 0.5);
z-index: 5;
opacity: 0;
transition: opacity 0.2s;
}
</style>
</head>
<body>
<div id="game-container">
<div id="score-display">分數: 0</div>
<div id="combo-display"></div>
<div class="track" id="track0">
<div class="receptor"></div>
</div>
<div class="track" id="track1" style="left: 25%;">
<div class="receptor"></div>
</div>
<div class="track" id="track2" style="left: 50%;">
<div class="receptor"></div>
</div>
<div class="track" id="track3" style="left: 75%;">
<div class="receptor"></div>
</div>
</div>
<div id="start-screen">
<h1>下落式節奏遊戲</h1>
<p>點擊開始遊戲</p>
<button id="start-button">開始</button>
</div>
<audio id="game-music" src="https://www.chosic.com/wp-content/uploads/2021/07/The-Road-Home.mp3" preload="auto"></audio>
<script>
const gameContainer = document.getElementById('game-container');
const scoreDisplay = document.getElementById('score-display');
const comboDisplay = document.getElementById('combo-display');
const tracks = [document.getElementById('track0'), document.getElementById('track1'), document.getElementById('track2'), document.getElementById('track3')];
const receptors = document.querySelectorAll('.receptor');
const startScreen = document.getElementById('start-screen');
const startButton = document.getElementById('start-button');
const gameMusic = document.getElementById('game-music');
let score = 0;
let combo = 0;
let noteSpeed = 3; // 調整音符下降速度 (秒)
let notes = [];
let gameStarted = false;
const receptorBottom = 10; // % from bottom
const perfectRange = 5; // % from receptor top for &#39;perfect&#39;
const goodRange = 10; // % from receptor top for &#39;good&#39;

// 節拍數據 (時間 in ms, 軌道 0-3)
const beatmap = [
    { time: 1000, track: 0 }, { time: 1500, track: 1 }, { time: 2000, track: 2 }, { time: 2500, track: 3 },
    { time: 3000, track: 0 }, { time: 3250, track: 2 }, { time: 3500, track: 1 }, { time: 3750, track: 3 },
    { time: 4000, track: 0 }, { time: 4000, track: 3 }, { time: 4500, track: 1 }, { time: 4500, track: 2 },
    { time: 5000, track: 0 }, { time: 5500, track: 1 }, { time: 6000, track: 2 }, { time: 6500, track: 3 },
    { time: 7000, track: 1 }, { time: 7250, track: 3 }, { time: 7500, track: 0 }, { time: 7750, track: 2 },
    { time: 8000, track: 1 }, { time: 8000, track: 2 }, { time: 8500, track: 0 }, { time: 8500, track: 3 },
    { time: 9000, track: 1 }, { time: 9250, track: 2 }, { time: 9500, track: 3 }, { time: 9750, track: 0 },
    { time: 10000, track: 1 }, { time: 10500, track: 2 }, { time: 11000, track: 0 }, { time: 11500, track: 3 },
    { time: 12000, track: 2 }, { time: 12250, track: 0 }, { time: 12500, track: 1 }, { time: 12750, track: 3 },
    { time: 13000, track: 0 }, { time: 13000, track: 2 }, { time: 13500, track: 1 }, { time: 13500, track: 3 },
    // ... 在此添加更多節拍
];

startButton.addEventListener(&#39;click&#39;, startGame);

function startGame() {
    startScreen.style.display = &#39;none&#39;;
    gameMusic.play();
    gameStarted = true;
    requestAnimationFrame(update);

    beatmap.forEach(noteData =&gt; {
        setTimeout(() =&gt; {
            createNote(noteData.track);
        }, noteData.time);
    });
}

function createNote(trackIndex) {
    const note = document.createElement(&#39;div&#39;);
    note.className = &#39;note&#39;;
    note.style.top = &#39;-5vh&#39;; // Start above the screen
    note.dataset.track = trackIndex;
    tracks[trackIndex].appendChild(note);
    notes.push(note);
}

function update() {
    if (!gameStarted) return;

    const containerHeight = gameContainer.clientHeight;
    const receptorPosition = containerHeight * (1 - receptorBottom / 100);

    notes.forEach((note, index) =&gt; {
        const currentTop = parseFloat(note.style.top);
        const newTop = currentTop + (containerHeight / (noteSpeed * 60)); // 60 FPS assumption
        note.style.transform = `translateY(${newTop}px)`;


        if (newTop &gt; containerHeight) {
            note.remove();
            notes.splice(index, 1);
            missedNote();
        }
    });

    requestAnimationFrame(update);
}

function handleInput(trackIndex) {
    if (!gameStarted) return;

    const receptor = receptors[trackIndex];
    receptor.classList.add(&#39;active&#39;);
    setTimeout(() =&gt; receptor.classList.remove(&#39;active&#39;), 100);

    const receptorPos = receptor.getBoundingClientRect().top;
    let hit = false;

    for (let i = notes.length - 1; i &gt;= 0; i--) {
        const note = notes[i];
        if (parseInt(note.dataset.track) === trackIndex) {
            const notePos = note.getBoundingClientRect().bottom;
            const distance = Math.abs(receptorPos - notePos);
            
            if (distance &lt; receptor.clientHeight * 0.8) { // Perfect
                updateScore(300);
                combo++;
                showCombo();
                note.remove();
                notes.splice(i, 1);
                hit = true;
                break;
            } else if (distance &lt; receptor.clientHeight * 1.2) { // Good
                updateScore(100);
                combo++;
                showCombo();
                note.remove();
                notes.splice(i, 1);
                hit = true;
                break;
            }
        }
    }

    if (!hit) {
        // No note was close enough to be hit, treat as a mistake.
    }
}

function missedNote() {
    combo = 0;
    showCombo();
}

function updateScore(points) {
    score += points + combo * 10;
    scoreDisplay.textContent = `分數: ${score}`;
}

function showCombo() {
    if (combo &gt; 2) {
        comboDisplay.textContent = `${combo} Combo`;
        comboDisplay.style.opacity = 1;
        setTimeout(() =&gt; {
            comboDisplay.style.opacity = 0;
        }, 500);
    } else {
        comboDisplay.style.opacity = 0;
    }
}

// Touch controls
for (let i = 0; i &lt; tracks.length; i++) {
    tracks[i].addEventListener(&#39;touchstart&#39;, (e) =&gt; {
        e.preventDefault();
        handleInput(i);
    });
}

</script>
</body>
</html>
